// Parser definition for use with Java Cup
package forthcompiler;

action code {:
public java_cup.runtime.ComplexSymbolFactory.Location getLeftLocation(
    java_cup.runtime.ComplexSymbolFactory.Location ... locations) {
  for (java_cup.runtime.ComplexSymbolFactory.Location l : locations) {
    if (l != null) {
      return l;
    }
  }
  return null;
}
:}
parser code {:
  public forthcompiler.Absyn.Prg pPrg() throws Exception
  {
    java_cup.runtime.Symbol res = parse();
    return (forthcompiler.Absyn.Prg) res.value;
  }

public void syntax_error(java_cup.runtime.Symbol cur_token)
{
  report_error("Syntax Error, trying to recover and continue parse...", cur_token);
}

public void unrecovered_syntax_error(java_cup.runtime.Symbol cur_token) throws java.lang.Exception
{
  throw new Exception("Unrecoverable Syntax Error");
}

:}

nonterminal forthcompiler.Absyn.Prg Prg;
nonterminal forthcompiler.Absyn.ListStatement ListStatement;
nonterminal forthcompiler.Absyn.Statement Statement;
nonterminal forthcompiler.Absyn.Expr Expr;
nonterminal forthcompiler.Absyn.Word Word;
nonterminal forthcompiler.Absyn.Constant Constant;
nonterminal forthcompiler.Absyn.ListExpr ListExpr;

terminal _SYMB_0;    //   :
terminal _SYMB_1;    //   ;
terminal _SYMB_2;    //   begin
terminal _SYMB_3;    //   if
terminal _SYMB_4;    //   then
terminal _SYMB_5;    //   until



terminal Integer _INTEGER_;



terminal String ForthWord;


start with Prg;


Prg ::= ListStatement:p_1  {: RESULT = new forthcompiler.Absyn.Program(p_1); :}
;
ListStatement ::= Statement:p_1  {: RESULT = new forthcompiler.Absyn.ListStatement(); RESULT.addLast(p_1); :}
  | Statement:p_1 ListStatement:p_2  {: RESULT = p_2; p_2.addFirst(p_1); :}
;
Statement ::= Constant:p_1  {: RESULT = new forthcompiler.Absyn.Literal(p_1); :}
  | Expr:p_1  {: RESULT = new forthcompiler.Absyn.Expression(p_1); :}
  | Word:p_1  {: RESULT = new forthcompiler.Absyn.SinlgeWord(p_1); :}
;
Expr ::= _SYMB_3:p_1 Statement:p_2 _SYMB_4:p_3  {: RESULT = new forthcompiler.Absyn.Conditional(p_2); :}
  | _SYMB_2:p_1 Statement:p_2 _SYMB_5:p_3  {: RESULT = new forthcompiler.Absyn.Loop(p_2); :}
  | _SYMB_0:p_1 Word:p_2 Statement:p_3 _SYMB_1:p_4  {: RESULT = new forthcompiler.Absyn.Define(p_2,p_3); :}
;
Word ::= ForthWord:p_1  {: RESULT = new forthcompiler.Absyn.Name(p_1); :}
;
Constant ::= _INTEGER_:p_1  {: RESULT = new forthcompiler.Absyn.Number(p_1); :}
;
ListExpr ::= Expr:p_1  {: RESULT = new forthcompiler.Absyn.ListExpr(); RESULT.addLast(p_1); :}
  | Expr:p_1 ListExpr:p_2  {: RESULT = p_2; p_2.addFirst(p_1); :}
;

